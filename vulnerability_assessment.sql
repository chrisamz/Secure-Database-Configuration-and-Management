-- vulnerability_assessment.sql
-- This script conducts a vulnerability assessment

-- Step 1: Check for weak passwords
-- Note: Replace the minimum length as needed
SELECT user, host 
FROM mysql.user 
WHERE LENGTH(authentication_string) < 8;

-- Step 2: Check for users without passwords
SELECT user, host 
FROM mysql.user 
WHERE authentication_string = '';

-- Step 3: Check for users with excessive privileges
SELECT user, host, Super_priv, Process_priv 
FROM mysql.user 
WHERE Super_priv = 'Y' OR Process_priv = 'Y';

-- Step 4: Check for users with wildcard hosts
SELECT user, host 
FROM mysql.user 
WHERE host = '%';

-- Step 5: Check for outdated software versions
SHOW VARIABLES LIKE 'version';
SHOW VARIABLES LIKE 'version_comment';

-- Step 6: Check for accounts with no password expiration
SELECT user, host 
FROM mysql.user 
WHERE password_expired = 'N';

-- Step 7: Check for anonymous accounts
SELECT user, host 
FROM mysql.user 
WHERE user = '';

-- Step 8: Check for test databases
SHOW DATABASES LIKE 'test%';

-- Step 9: Check for databases with weak permissions
-- List all databases
SELECT schema_name 
FROM information_schema.schemata;

-- Check database permissions
SELECT table_schema, 
       table_name, 
       privilege_type 
FROM information_schema.schema_privileges 
WHERE privilege_type IN ('SELECT', 'INSERT', 'UPDATE', 'DELETE') 
AND grantee NOT IN ('root', 'mysql.sys', 'mysql.session', 'mysql.infoschema');

-- Step 10: Check for any binary logging configuration issues
SHOW VARIABLES LIKE 'log_bin';
SHOW VARIABLES LIKE 'binlog_format';
SHOW VARIABLES LIKE 'server_id';

-- Step 11: Check for SSL/TLS configuration
SHOW VARIABLES LIKE '%ssl%';

-- Step 12: Check for any non-default users with GRANT OPTION privilege
SELECT user, host 
FROM mysql.user 
WHERE Grant_priv = 'Y' AND user NOT IN ('root', 'mysql.sys', 'mysql.session', 'mysql.infoschema');

-- Step 13: Check for stored procedures or functions with SQL injection risk
SELECT ROUTINE_SCHEMA, ROUTINE_NAME, ROUTINE_TYPE 
FROM information_schema.routines 
WHERE routine_definition LIKE '%concat%' 
AND routine_definition LIKE '%user()%' 
AND routine_definition LIKE '%select%';
